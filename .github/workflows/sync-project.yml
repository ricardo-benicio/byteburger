name: Sync Issues to Project Board

on:
  issues:
    types: [opened, labeled, unlabeled, closed, reopened]
  pull_request:
    types: [opened, labeled, unlabeled, closed, reopened]

jobs:
  add-to-project:
    name: Add to Project
    runs-on: ubuntu-latest
    steps:
      - name: Add item to project
        uses: actions/add-to-project@v0.5.0
        with:
          project-url: https://github.com/users/ricardo-benicio/projects/16
          github-token: ${{ secrets.GH_PROJECT_TOKEN }}

  update-status:
    name: Update Status Column
    runs-on: ubuntu-latest
    needs: add-to-project
    steps:
      - name: Update project status
        uses: leonsteinhaeuser/project-beta-automations@v2.2.1
        with:
          gh_token: ${{ secrets.GH_PROJECT_TOKEN }}
          organization: ricardo-benicio
          project_id: 16
          resource_node_id: ${{ github.event.issue.node_id || github.event.pull_request.node_id }}
          status_value: |
            ${{
              (github.event.issue.state == 'closed' || github.event.pull_request.merged) && 'Done' ||
              contains(github.event.issue.labels.*.name, 'done') && 'Done' ||
              contains(github.event.issue.labels.*.name, 'review') && 'In Review' ||
              contains(github.event.issue.labels.*.name, 'in-progress') && 'In Progress' ||
              'Backlog'
            }}
